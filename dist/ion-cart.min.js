!function(t){var e=t.module("ionShop.services",["ionic"]);e.service("Products",[function(){this.products=[],this.checkout={},this.removeProduct=function(t){this.products.forEach(function(e,i){t.id===e.id&&(this.products.splice(i,1),this.updateTotal())}.bind(this))},this.addOneProduct=function(t){t.quantity++,this.updateTotal()},this.removeOneProduct=function(t){t.quantity--,this.updateTotal()},this.cartTotal=function(){var e=0;return this.products.forEach(function(t){e+=t.price*t.quantity}),t(e)};var t=function(t){return t.toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$&,")};this.updateTotal=function(){this.total=this.cartTotal()}.bind(this),this.updateTotal()}]),e.service("CheckoutValidation",function(){var t={visa:/^4[0-9]{6,}$/,masterCard:/^5[1-5][0-9]{5,}$/,amex:/^3[47][0-9]{5,}$/,diners:/^3(?:0[0-5]|[68][0-9])[0-9]{4,}$/,discover:/^6(?:011|5[0-9]{2})[0-9]{3,}$/,jcb:/^(?:2131|1800|35[0-9]{3})[0-9]{3,}$/},e={visa:"../../images/creditcards/visa.png",masterCard:"../../images/creditcards/mastercard.png",amex:"../../images/creditcards/amex.png",diners:"../../images/creditcards/diners.png",discover:"../../images/creditcards/discover.png",jcb:"../../images/creditcards/jcb.png"};this.cardType=function(i){i=i.split(" ").join("");for(var n in t)t[n].test(i)&&console.log(e[n])},this.validateCreditCardNumber=function(t){return Stripe.card.validateCardNumber(t)},this.validateExpiry=function(t,e){return Stripe.card.validateExpiry(t,e)},this.validateCVC=function(t){return Stripe.card.validateCVC(t)},this.validateEmail=function(t){var e=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return e.test(t)},this.validateZipcode=function(t){var e=/(^\d{5}$)|(^\d{5}-\d{4}$)/;return e.test(t)},this.checkAll=function(t){if(0===Object.keys(t).length)return!1;for(var e in t){if("cc"===e&&!this.validateCreditCardNumber(t[e]))return!1;if("exp"===e&&!this.validateExpiry(t[e].slice(0,2),t[e].slice(3)))return!1;if("cvc"===e&&!this.validateCVC(t[e]))return!1;if("email"===e&&!this.validateEmail(t[e]))return!1;if("zipcode"===e&&!this.validateZipcode(t[e]))return!1}return!0}.bind(this)}),e.service("stripeCheckout",["Products","CheckoutValidation","$http",function(t,e,i){this.setStripeKey=function(t){Stripe.setPublishableKey(t)},this.processCheckout=function(t){var e=t.cc,i=t.exp.slice(0,2),o=t.exp.slice(3),r=t.cvc;Stripe.card.createToken({number:e,cvc:r,exp_month:i,exp_year:o},n)};var n=function(t,e){e.error?console.log(e.error):(console.log(e),o(e))},o=function(t){var e=t.id;url="/stripe/pay",i.post(url,{stripeToken:e})}}])}(angular),function(t){var e=t.module("ionShop.directives",["ionic","ionShop.services"]);e.directive("ionCart",["Products",function(t){var e=function(e){e.$watch(function(){return t.products},function(){t.updateTotal(),e.emptyProducts=t.products.length?!1:!0}),e.emptyProducts=t.products.length?!1:!0,e.addProduct=function(e){t.addOneProduct(e)},e.removeProduct=function(e){e.quantity<=1?t.removeProduct(e):t.removeOneProduct(e)}};return{restrict:"AEC",templateUrl:function(){return"dist/views/cart-item.html"},link:e,scope:{products:"=products"}}}]),e.directive("ionProductImage",["$timeout","$ionicModal","$ionicSlideBoxDelegate",function(t,e,i){var n=function(n,o){n.closeModal=function(){n.modal.hide(),n.modal.remove()},o.on("click",function(){e.fromTemplateUrl("dist/views/partials/cart-image-modal.html",{animation:"slide-left-right",scope:n}).then(function(e){n.modal=e,n.modal.show(),t(function(){i.update()})})})};return{restrict:"A",link:n,scope:"="}}]),e.directive("ionCheckout",["$state",function(t){var e=function(e,i){i.addClass("bar bar-footer bar-dark"),i.on("click",function(){t.go(e.path)}),i.on("touchstart",function(){i.css({opacity:.8})}),i.on("touchend",function(){i.css({opacity:1})})};return{restrict:"AEC",templateUrl:"dist/views/checkout-footer.html",scope:{path:"=path"},link:e}}]),e.directive("ionPurchase",["Products",function(t){var e=function(e,i){e.$watch(function(){return t.total},function(){e.total=t.total}),e.checkout=t.checkout,e.total=t.total,i[0].hasAttribute("has-address")&&(e.hasAddressDir=!0),i[0].hasAttribute("has-email")&&(e.hasEmailDir=!0),i[0].hasAttribute("has-name")&&(e.hasNameDir=!0)};return{restrict:"AEC",templateUrl:"dist/views/purchase.html",link:e}}]),e.directive("ionPurchaseFooter",["$compile","Products","stripeCheckout","CheckoutValidation",function(e,i,n,o){var r=function(e,r){e.checkout=i.checkout,e.processCheckout=n.processCheckout,r.addClass("bar bar-footer bar-dark"),r.on("click",function(){if(o.checkAll(e.checkout))e.processCheckout(e.checkout);else{var i=document.getElementsByTagName("ion-purchase")[0].children[0];t.element(i).html("Please correct the following:").css({color:"#ED303C",opacity:1})}}),r.on("touchstart",function(){r.css({opacity:.8})}),r.on("touchend",function(){r.css({opacity:1})})};return{restrict:"AEC",templateUrl:"dist/views/purchase-footer.html",link:r}}]),e.directive("checkoutCard",function(){var t=function(){};return{restrict:"AEC",link:t,templateUrl:"dist/views/partials/card-form.html"}}),e.directive("cardNumInput",["$timeout","CheckoutValidation",function(e,i){var n=function(n,o){var r=(o.children()[0].children[0],o.children()[0].children[1]);n.onNumBlur=function(){n.checkout.cc&&(t.element(r).removeClass("ion-card"),t.element(r).addClass("ion-loading-d"),e(function(){return i.validateCreditCardNumber(n.checkout.cc)?(t.element(r).removeClass("ion-loading-d"),void t.element(r).addClass("ion-checkmark-round").css({color:"#1fda9a"})):(t.element(r).removeClass("ion-loading-d"),void t.element(r).addClass("ion-close-round").css({color:"#ED303C"}))},300))},n.onNumFocus=function(){t.element(r).removeClass("ion-checkmark-round ion-close-round"),t.element(r).addClass("ion-card").css({color:"#333"})}};return{restrict:"AEC",link:n,templateUrl:"dist/views/partials/card-num-input.html"}}]),e.directive("cardExpInput",["$timeout","CheckoutValidation",function(e,i){var n=function(n,o){var r=(o.children()[0].children[0],o.children()[0].children[1]);n.onExpBlur=function(){n.checkout.exp&&(t.element(r).addClass("ion-loading-d"),e(function(){return n.checkout.exp&&i.validateExpiry(n.checkout.exp.slice(0,2),n.checkout.exp.slice(3))?(t.element(r).removeClass("ion-loading-d"),void t.element(r).addClass("ion-checkmark-round").css({color:"#1fda9a"})):(t.element(r).removeClass("ion-loading-d"),void t.element(r).addClass("ion-close-round").css({color:"#ED303C"}))},300))},n.onExpFocus=function(){t.element(r).removeClass("ion-checkmark-round ion-close-round").css({color:"#333"})}};return{restrict:"AEC",link:n,templateUrl:"dist/views/partials/card-exp-input.html"}}]),e.directive("cardCvcInput",["$timeout","CheckoutValidation",function(e,i){var n=function(n,o){var r=(o.children()[0].children[0],o.children()[0].children[1]);n.onCvcBlur=function(){n.checkout.cvc&&(t.element(r).addClass("ion-loading-d"),e(function(){return i.validateCVC(n.checkout.cvc)?(t.element(r).removeClass("ion-loading-d"),void t.element(r).addClass("ion-checkmark-round").css({color:"#1fda9a"})):(t.element(r).removeClass("ion-loading-d"),void t.element(r).addClass("ion-close-round").css({color:"#ED303C"}))},300))},n.onCvcFocus=function(){t.element(r).removeClass("ion-checkmark-round ion-close-round").css({color:"#333"})}};return{restrict:"AEC",link:n,templateUrl:"dist/views/partials/card-cvc-input.html"}}]),e.directive("checkoutAddress",function(){var t=function(){};return{restrict:"AEC",link:t,templateUrl:"dist/views/partials/address.html"}}),e.directive("addressOneInput",function(){var t=function(){};return{restrict:"AEC",link:t,templateUrl:"dist/views/partials/address-line-one.html"}}),e.directive("addressTwoInput",function(){var t=function(t){t.onAddrTwoBlur=function(){},t.onAddrTwoFocus=function(){}};return{restrict:"AEC",link:t,templateUrl:"dist/views/partials/address-line-two.html"}}),e.directive("cityInput",function(){var t=function(t){t.onCityBlur=function(){},t.onCityFocus=function(){}};return{restrict:"AEC",link:t,templateUrl:"dist/views/partials/city-input.html"}}),e.directive("stateInput",function(){var t=function(t){t.onStateBlur=function(){},t.onStateFocus=function(){}};return{restrict:"AEC",link:t,templateUrl:"dist/views/partials/state-input.html"}}),e.directive("zipInput",["$timeout","CheckoutValidation",function(e,i){var n=function(n,o){var r=o.children()[0].children[1];n.onZipBlur=function(){n.checkout.zipcode&&(t.element(r).addClass("ion-loading-d"),e(function(){return i.validateZipcode(n.checkout.zipcode)?(t.element(r).removeClass("ion-loading-d"),void t.element(r).addClass("ion-checkmark-round").css({color:"#1fda9a"})):(t.element(r).removeClass("ion-loading-d"),void t.element(r).addClass("ion-close-round").css({color:"#ED303C"}))},300))},n.onZipFocus=function(){t.element(r).removeClass("ion-checkmark-round ion-close-round").css({color:"#333"})}};return{restrict:"AEC",link:n,templateUrl:"dist/views/partials/zipcode-input.html"}}]),e.directive("checkoutName",function(){var t=function(){};return{restrict:"AEC",link:t,templateUrl:"dist/views/partials/name-input.html"}}),e.directive("lastNameInput",function(){var t=function(){};return{restrict:"AEC",link:t,templateUrl:"dist/views/partials/first-name-input.html"}}),e.directive("firstNameInput",function(){var t=function(){};return{restrict:"AEC",link:t,templateUrl:"dist/views/partials/last-name-input.html"}}),e.directive("checkoutEmail",["$timeout","CheckoutValidation",function(e,i){var n=function(n,o){var r=o.children()[1].children[1];n.onEmailBlur=function(){n.checkout.email&&(t.element(r).addClass("ion-loading-d"),e(function(){return i.validateEmail(n.checkout.email)?(t.element(r).removeClass("ion-loading-d"),void t.element(r).addClass("ion-checkmark-round").css({color:"#1fda9a"})):(t.element(r).removeClass("ion-loading-d"),void t.element(r).addClass("ion-close-round").css({color:"#ED303C"}))},300))},n.onEmailFocus=function(){t.element(r).removeClass("ion-checkmark-round ion-close-round").css({color:"#333"})}};return{restrict:"AEC",link:n,templateUrl:"dist/views/partials/email-input.html"}}]),e.directive("mouseDownUp",function(){var t=function(t,e){e.on("touchstart",function(){e.css({opacity:.5})}),e.on("touchend",function(){e.css({opacity:1})})};return{restrict:"AC",link:t}})}(angular),function(t){t.module("ionicShop",["ionic","ionShop.services","ionShop.directives"])}(angular);